---
share: true
---

# Homogeneous Coordinates

## Concept

- 齐次坐标（Homogeneous Coordinates）通过添加一个额外的维度来扩展传统的坐标系统，使得包括平移在内的仿射变换可以通过矩阵乘法来实现；

- 在二维空间中，一个点的齐次坐标是通过添加一个第三个坐标$w$来表示的，通常取值为 1。因此，一个二维空间中的点$(x,y)$在齐次坐标中表示为$(wx,wy,w)$。类似地，在三维空间中，一个点的齐次坐标是$(wx,wy,wz,w)$；

## 优点
1. 无穷远点的表示： 齐次坐标允许表示无穷远处的点。在传统坐标中，无穷远点无法被表示，因为它们需要无限大的坐标值。但在齐次坐标中，当$w=0$时，表示这个点位于无穷远处；
2. 统一变换表示： 齐次坐标使得所有的仿射变换（包括平移）都可以用矩阵乘法表示；

# Landmark

$\underline{欧式距离}$
$$P=[x,y,z]$$

$\underline{逆深度}$
- 定义：相机坐标系下的空间点深度的逆：
$$\lambda = \frac{1}{z}$$
- 同时包含第一次观测到这个路标点时的camera pose；

- 优势
1. 能表示无限远处的点
2. 在初始化时的相对观测量的线性化程度高

- 劣势
1. 参数需要带上第一次观测的相机pose
2. 计算量大，倒数运算

- Ref：Inverse Depth Parametrization for Monocular SLAM.pdf

# Vector
 
- 内积: $a \cdot b$：$b$向量在$a$向量方向上的投影，计算公式为：
$$
a \cdot b = |a||b|cos(a, b)=\sum{a_ib_i}
$$
- 其结果是一个标量。
- 外积: $a \times b$：结果是方向垂直于这两个向量的向量，$a$, $b$和$a \times b$构成右手系。大小由两个向量的夹角决定，长度为$|a||b|sin(a, b)$。可以用来表示旋转，计算公式是：
$$
a \times b = \begin{bmatrix} 
a_y b_z - a_z b_y \\
a_z b_x - a_x b_z \\
a_x b_y - a_y b_x 
\end{bmatrix}
$$
- 反对称矩阵: $a^\wedge$，定义如下：
$$
a^\wedge=\begin{bmatrix} 
   0 & a_1 & -a_2  \\\
   -a_1 & 0 & a_3  \\\
   -a_2 & -a_3 & 0  \\
 \end{bmatrix}
$$
特征是对角线元素为0，上下三角元素取反。可以用来表示向量的外积操作, $a \times b = a^\wedge b$。

# Rotation Matrix

$\underline{Property}$
- 3x3的矩阵，描述了姿态的变换；
- 满足$RR^T = I$ (单位矩阵) 。
- $\det(R) = 1$。
- 属于正交矩阵群，转置即逆阵。
- 过参数化的定义，而且会在优化问题中引入限制，即必须是正交矩阵，行列式为1。

$\underline{Usage}$
- 左乘对向量$a$进行旋转，$a^\prime=Ra$；

# Transform Matrix
- Transform可以用4x4矩阵表示：
$$
\left[\begin{array}{ll}
\boldsymbol{R} & \boldsymbol{t} \\
\mathbf{0}^{T} & 1
\end{array}\right]
$$

- 与齐次坐标配合使用可以表示连续的坐标变换，比如$a^\prime=T_1T_2a$；
- 上式描述利用$T_1$和$T_2$对空间点$a$进行变换，成为$a^\prime$，其中$a$是齐次坐标：
$$
a=
\begin{bmatrix} 
	x \\\
	y \\\
	z \\\
	1
\end{bmatrix}
$$

# Rotation Vector

- 也被称为轴角Axis-Angle；
- Idea：任何旋转都可以通过一个旋转轴和旋转角来刻画；
- Property：方向与旋转轴一致，大小等于旋转角，通过下式定义：
$$
v=\theta n
$$
- 其中：
1. $\theta$表示旋转角度，标量，DoF=1；
2. $n$是与旋转轴一致的3维单位向量，DoF = 2。$n$是旋转矩阵$R$在特征值为1时的特征向量，在旋转轴上的向量经过旋转矩阵旋转之后不会发生变化，满足$Rn = n$
3. 实际上就是旋转矩阵的李代数，可以用罗德里格斯公式转换为旋转矩阵；

# 欧拉角

## Concept
- 欧拉角是描述刚体在三维空间中取向的一组三个角度。欧拉角通过三次旋转将一个坐标系转换到一个目标坐标系，这三次旋转通常围绕不同的轴进行；
- 欧拉角的三个角通常分别称为：
	1. 滚转角（Roll）：$\phi$，围绕X轴的旋转。
	2. 俯仰角（Pitch）：$\theta$，围绕新的Y轴的旋转（经过第一次旋转后的Y轴）。
	3. 偏航角（Yaw）：$\psi$，围绕新的Z轴的旋转（经过前两次旋转后的Z轴）。
- 这三个角度定义了从初始坐标系到旋转后坐标系的变换。欧拉角的旋转顺序很重要，因为不同的旋转顺序会导致不同的结果（这是由于旋转的非交换性）。常见的旋转顺序有：
- ZYX顺序：先偏航，然后俯仰，最后滚转，这在航空领域中非常常见。
- XYZ顺序：先滚转，然后俯仰，最后偏航，这在机器人学中比较常见。

## Property
- 欧拉角表示旋转会有万向锁引起的奇异性问题，当pitch等于$\frac{\pi}{2}$时，经过roll，pitch和yaw的旋转后，最终的旋转矩阵只和(roll - yaw)有关，即丢失了一个自由度；
- 欧拉角是旋转的最小的参数化表示，但是有奇异性；
- 很难/几乎不可能用来表示旋转组合；
- Ref：https://www.euclideanspace.com/maths/geometry/rotations/euler/index.htm

# Quaternion
## Idea
- 通过复数来表示旋转

## Property
- 由一个实部和三个虚部组成，每个虚部代表一个轴，定义
$$q= w + xi + yj + zk$$
- 所有的三维旋转都可以由一个单位四元数表示，自由度为3；
- $q$和$-q$表示同一个旋转，实质上是多转了$2\pi$；
- Identity Quaternion：实部为1，虚部为0。表示没有旋转；
- 单位四元数和轴角的关系，如下式：
$$
q = 
\begin{bmatrix} 
	cos(\theta/2) \\\
	sin(\theta/2)n_x \\\
	sin(\theta/2)n_y \\\
	sin(\theta/2)n_z 
\end{bmatrix}
$$
- 其中，轴角$n$的旋转向量是：
$$
n=
\begin{bmatrix} 
	n_x \\\
	n_y \\\
	n_z 
\end{bmatrix}
$$
- 由此看出四元数只表示了一半的旋转；
- 四元数是最小的过参数化定义；


## 全虚四元数

- 全虚四元数是形式为$0+xi+yj+zk$的四元数；
- 全虚四元数可以直接表示为三维向量$(x,y,z)$，用于表示绕相应轴的无穷小旋转；
- 在数学上，可以将$\mathfrak{so}(3)$李代数元素和全虚四元数之间建立直接的对应关系。具体来说，$\mathfrak{so}(3)$李代数元素中的非零元素与全虚四元数的虚部分量一一对应；

## 指数映射

- 四元数的指数映射是一个数学操作，它将李代数（特别是四元数的全虚部分）中的元素映射到李群（在这种情况下，是单位四元数）上；
- 这在三维旋转的上下文中特别有用，因为它允许将无穷小旋转（由全虚四元数表示）映射到有限旋转（由单位四元数表示）；
- 给定一个全虚四元数$q=0+xi+yj+zk$其中$x,y,z$ 表示绕一个特定轴的旋转向量，四元数的指数映射可以定义为：
$$
e^q=cos(||q||)+\frac{q}{||q||}sin(||q||)
$$
- 其中$||q||$是四元数的模，它表示旋转的角度；
- 结果是一个单位四元数，表示了对应于旋转向量$q$的有限旋转。这个单位四元数可以用来直接在三维空间中应用旋转；

## Operation

- 加，减：Trivial；
- 两个四元数相乘：不满足交换律；
- 共轭：$q^*$，虚部取反；
- 模：所有系数的平方根；
- 逆： 定义为$q^{-1}=\frac{q^*}{||q||^2}$，表示q的反向旋转；
	1. 其满足：$q^{-1}q = qq^{-1} = 1$；
	2. 对单位四元数来说，$q^*$和$q^{-1}$一样；

## Rotation Action

- 被转换的点$a = [x, y, z]$：
- 旋转：利用一个单位四元数定义：
$$
q=
\begin{bmatrix} 
	cos(\theta/2) \\\
	sin(\theta/2)n
\end{bmatrix}
$$
它表示一个围绕向量$n$旋转$\theta/2$角的旋转;
- 旋转后的点：
$$
a^\prime = qaq^{-1}
$$

## Kinematics

- 如果四元数代表姿态，那么姿态的变化率$\dot{q}$可以用角速度$\omega$计算：
$$
\dot{q} = \frac{1}{2}q \otimes \omega
$$

- 其中$\otimes$是四元数乘法；

## Rotation Combination
- 四元数的旋转组合涉及将两个旋转合并为一个单独的旋转。
- 如果有两个四元数$q_1$和$q_2$，分别代表两个旋转，当我们讨论的是物体本身的旋转，那么它们的组合旋转 $q$ 可以通过四元数乘法来实现：
$$
q=q_2q_1
$$
- 这里$q_2$是第二个执行的旋转，$q_1$是第一个执行的旋转。
- 当我们讨论的是坐标轴的旋转，则组合出的旋转是：
$$
q=q_1q_2
$$


## Convention
- 分为Hamilton和JPL系，他们相同的点是：
$$
i^2 = j^2 = k^2 = -1
$$
- 不同点是：
	- Hamilton：$ijk = -1$，右手系，prefered；
	- JPL：$ijk = 1$

